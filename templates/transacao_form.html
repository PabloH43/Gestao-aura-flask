<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Editar Transação' if transacao else 'Nova Transação' }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>{{ 'Editar Transação' if transacao else 'Nova Transação' }}</h2>
    <form method="POST">
        <!-- Tipo -->
        <div class="mb-3">
            <label for="tipo" class="form-label">Tipo</label>
            <input type="text" list="tipos_list" class="form-control" id="tipo" name="tipo" 
                   value="{{ transacao.tipo if transacao else '' }}" placeholder="Digite ou selecione" required>
            <datalist id="tipos_list">
                <option value="Entrada"></option>
                <option value="Saída"></option>
            </datalist>
        </div>

        <!-- Natureza -->
        <div class="mb-3">
            <label for="natureza" class="form-label">Natureza</label>
            <input type="text" list="naturezas_list" class="form-control" id="natureza" name="natureza" 
                   value="{{ transacao.entidade_tipo if transacao else '' }}" placeholder="Digite ou selecione" required onchange="atualizarEntidade()">
            <datalist id="naturezas_list">
                <option value="Cliente"></option>
                <option value="Colaborador"></option>
                <option value="Despesa Geral"></option>
            </datalist>
        </div>

        <!-- Entidade -->
        <div class="mb-3">
            <label for="entidade" class="form-label">Entidade</label>
            <input type="text" list="entidades_list" class="form-control" id="entidade" name="entidade" 
                   value="{{ transacao.entidade if transacao else '' }}" placeholder="Digite ou selecione" required>
            <datalist id="entidades_list">
                {% for e in clientes %}
                    <option value="{{ e }}"></option>
                {% endfor %}
                {% for e in colaboradores %}
                    <option value="{{ e }}"></option>
                {% endfor %}
                {% for e in despesas %}
                    <option value="{{ e }}"></option>
                {% endfor %}
            </datalist>
        </div>

        <!-- Categoria -->
        <div class="mb-3">
            <label for="categoria" class="form-label">Categoria</label>
            <input type="text" list="categorias_list" class="form-control" id="categoria" name="categoria" 
                   value="{{ transacao.categoria if transacao else '' }}" placeholder="Digite ou selecione">
            <datalist id="categorias_list">
                <option value="Aluguel"></option>
                <option value="Material"></option>
                <option value="Serviço"></option>
                <option value="Outros"></option>
            </datalist>
        </div>

        <!-- Descrição -->
        <div class="mb-3">
            <label for="descricao" class="form-label">Descrição</label>
            <textarea class="form-control" id="descricao" name="descricao" rows="2" required>{{ transacao.descricao if transacao else '' }}</textarea>
        </div>

        <!-- Valor -->
        <div class="mb-3">
            <label for="valor" class="form-label">Valor</label>
            <input type="text" class="form-control" id="valor" name="valor" value="{{ transacao.valor if transacao else '' }}" required>
        </div>

        <!-- Data de Vencimento -->
        <div class="mb-3">
            <label for="data_vencimento" class="form-label">Data de Vencimento</label>
            <input type="date" class="form-control" id="data_vencimento" name="data_vencimento" value="{{ transacao.data_vencimento if transacao else '' }}" required>
        </div>

        <!-- Status -->
        <div class="mb-3">
            <label for="status" class="form-label">Status</label>
            <input type="text" list="status_list" class="form-control" id="status" name="status" value="{{ transacao.status if transacao else 'Pendente' }}" required>
            <datalist id="status_list">
                <option value="Pendente"></option>
                <option value="Pago"></option>
                <option value="Cancelado"></option>
            </datalist>
        </div>

        <button type="submit" class="btn btn-primary">{{ 'Atualizar' if transacao else 'Adicionar' }}</button>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancelar</a>
    </form>
</div>

<script>
function atualizarEntidade() {
    var natureza = document.getElementById("natureza").value;
    var datalist = document.getElementById("entidades_list");
    var valorAtual = document.getElementById("entidade").value; // mantém valor digitado
    datalist.innerHTML = "";

    var clientes = {{ clientes|tojson }};
    var colaboradores = {{ colaboradores|tojson }};
    var despesas = {{ despesas|tojson }};
    var lista = [];

    if (natureza === "Cliente") lista = clientes;
    else if (natureza === "Colaborador") lista = colaboradores;
    else if (natureza === "Despesa Geral") lista = despesas;

    lista.forEach(function(item) {
        var option = document.createElement("option");
        option.value = item;
        datalist.appendChild(option);
    });

    document.getElementById("entidade").value = valorAtual;
}
</script>

</body>
</html>
